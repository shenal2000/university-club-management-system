<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club management System</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
<style>
    body {
    font-family: Arial, sans-serif;
    background: #f5f6fa;
    margin: 0;
}

/* MAIN PAGE CONTAINER */
.announcements-page {
    max-width: 1200px;
    margin: 40px auto;
    padding: 0 24px;
}

/* SECTION HEADINGS */
.main-section h2,
.club-section h2 {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: #6b7280;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 16px;
}

.main-section h2::after,
.club-section h2::after {
    content: "";
    flex: 1;
    height: 1px;
    background: #e5e7eb;
}

/* CLUB BLOCK */
.club-section {
    margin-bottom: 60px;
}

/* GRID */
.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 28px;
}

/* CARD */
.event-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 14px;
    padding: 22px;
    transition: 0.25s;
}

.event-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.08);
}

.event-card h4 {
    font-size: 18px;
    margin-bottom: 10px;
}

.event-card p {
    font-size: 14px;
    color: #4b5563;
}

/* BADGE */
.badge {
    display: inline-block;
    margin-top: 12px;
    background: #16a34a;
    color: #fff;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
}

/* NO DATA */
.no-data {
    font-style: italic;
    color: #9ca3af;
}

</style>


</head>
<body>
<navbar-section>
    <div class="navbar">
        <div class="logo">
            <img src="nsbm.png" alt="NSBM Logo">
        </div>

        <div class="search-bar">
            <input type="text" placeholder="Search...">
        </div>
        <div class="menu">
            <a href="index.html">Home</a>
            <a href="club.html">Club</a>
            <a href="events.html">Events</a>
            <a href="announcement.html">Announcement</a>
            <a href="aboutus.html">About Us</a>
            <a href="contactus.html">Contact Us</a>
            <a href="faq.html">FAQ</a>
        </div>
        <div style="position: relative;">
            <button id="loginBtn" class="login-btn">Login</button>
            <div id="logoutMenu">
                <button id="logoutBtn">Logout</button>
            </div>
        </div>

        <div class="hamburger" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <div class="mobile-menu" id="mobileMenu">
        <div class="close-btn" onclick="toggleMenu()">Ã—</div>
        <a href="index.html">Home</a>
        <a href="club.html">Club</a>
        <a href="events.html">Events</a>
        <a href="announcement.html">Announcement</a>
        <a href="aboutus.html">About Us</a>
        <a href="contactus.html">Contact Us</a>
        <a href="faq.html">FAQ</a>
    </div>
</navbar-section>


<div class="announcements-page">
<!-- MAIN ANNOUNCEMENTS -->
<section class="main-section">
    <h2>Announcements</h2>
    <div id="mainAnnouncements" class="events-grid"></div>
</section> <br><br>

<!-- CLUB ANNOUNCEMENTS -->
<section class="club-section">
    <h2>Club Announcements</h2> <br>
    <div id="clubAnnouncements"></div>
</section>
</div>


<script>
    const BASE = "http://localhost:8080";

    const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));
    if (!loggedUser || !loggedUser.userId) {
        document.getElementById("clubAnnouncements").innerHTML =
            "<p class='no-data'>Please login to view announcements.</p>";
        throw new Error("User not logged in");
    }

    const loggedUserId = Number(loggedUser.userId);
    console.log("Logged User ID:", loggedUserId);

    /* ================= LOAD USER MEMBERSHIPS ================= */
    fetch(`${BASE}/club-members`)
        .then(res => res.json())
        .then(members => {

            console.log("All memberships:", members);

            const myMemberships = members.filter(m => {
                // SAFE detection for all backend JSON shapes
                if (m.user && m.user.userId) {
                    return Number(m.user.userId) === loggedUserId;
                }
                if (m.userId) {
                    return Number(m.userId) === loggedUserId;
                }
                return false;
            });

            console.log("My memberships:", myMemberships);

            if (myMemberships.length === 0) {
                document.getElementById("clubAnnouncements").innerHTML =
                    "<p class='no-data'>You are not a member of any club.</p>";
                return;
            }

            // Load announcements club by club
            myMemberships.forEach(m => {
                if (!m.club || !m.club.clubId) return;
                loadClubAnnouncements(m.club);
            });
        })
        .catch(err => {
            console.error("Membership load failed:", err);
            document.getElementById("clubAnnouncements").innerHTML =
                "<p class='no-data'>Failed to load announcements.</p>";
        });

    /* ================= LOAD ANNOUNCEMENTS BY CLUB ================= */
    function loadClubAnnouncements(club) {
        fetch(`${BASE}/api/announcements/club/${club.clubId}`)
            .then(res => res.json())
            .then(list => {
                if (!list || list.length === 0) return;
                renderClubSection(club.clubName, list);
            })
            .catch(err => console.error("Announcement error:", err));
    }

    /* ================= RENDER CLUB SECTION ================= */
    function renderClubSection(clubName, announcements) {
        const container = document.getElementById("clubAnnouncements");

        const block = document.createElement("div");
        block.className = "club-block";

        block.innerHTML = `
            <h3 class="club-title">${clubName}</h3> <br>
            <div class="events-grid">
                ${announcements.map(a => announcementCard(a)).join("")}
            </div>
        `;

        container.appendChild(block);
    }

    /* ================= ANNOUNCEMENT CARD ================= */
    function announcementCard(a) {
        return `
            <div class="event-card">
                <h4>${a.announcementTitle}</h4>
                <p>${a.announcementDescription || "No description provided."}</p>
            </div>
        `;
    }
</script>





<script src="script.js"></script>
<footer class="nsbm-footer">
    <div class="footer-content">

        <div class="footer-column branding-column">
            <h3>NSBM Club Management System</h3>
            <p>Empowering students at NSBM Green University <br>through clubs, learning, and <br>leadership opportunities.</p>
            <div class="social-links">
                <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Youtube"><i class="fa-brands fa-youtube"></i></a>
                <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>

        <div class="footer-column links-column">
            <h3>Featured Links</h3>
            <ul>
                <li><a href="#">My profile</a></li>
                <li><a href="#">Clubs</a></li>
                <li><a href="#">Events</a></li>
                <li><a href="#">Announcements</a></li>
                <li><a href="#">Privacy policy</a></li>
                <li><a href="#">FAQ</a></li>
            </ul>
        </div>

        <div class="footer-column contact-column">
            <h3>Contact & Resources</h3>
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <a href="#">clubmanagement@nsbm.ac.lk</a>
            </div>
            <div class="contact-item">
                <i class="fas fa-phone-alt"></i>
                <span>+94 11 544 5000</span>
            </div>
            <ul>
                <li><a href="https://www.nsbm.ac.lk/">NSBM Main Website</a></li>
            </ul>
        </div>
    </div>

    <div class="footer-bottom">
        <p>&copy; NSBM Club management System All Right Reserved.</p>
    </div>
</footer>
</body>
</html>
